# GitHub Actions Secrets Configuration

## ðŸ“‹ Required Secrets

Configure these secrets in your GitHub repository settings:
Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret

### Authentication & Access

```
GITHUB_TOKEN              - Auto-generated by GitHub
DEPLOY_KEY                - SSH key for deployment
DEPLOY_URL                - Deployment endpoint URL
SNYK_TOKEN                - Snyk security scanning token
SONAR_TOKEN               - SonarCloud analysis token
```

### Notifications

```
SLACK_WEBHOOK_URL         - Slack webhook for notifications
EMAIL_NOTIFICATION_TOKEN  - Email service token (optional)
```

### Container Registry

```
DOCKER_USERNAME           - Docker Hub username (optional)
DOCKER_PASSWORD           - Docker Hub password (optional)
GHCR_TOKEN                - GitHub Container Registry token
```

### Cloud Deployment

```
AWS_ACCESS_KEY_ID         - AWS credentials
AWS_SECRET_ACCESS_KEY     - AWS credentials
AWS_REGION                - AWS region
AZURE_CREDENTIALS         - Azure service principal
DIGITALOCEAN_TOKEN        - DigitalOcean API token
```

---

## ðŸ”§ Setting Up Secrets

### Step 1: Navigate to Repository Settings
1. Go to your GitHub repository
2. Click Settings â†’ Secrets and variables â†’ Actions

### Step 2: Create New Secrets
Click "New repository secret" for each secret:

**Example: Adding SLACK_WEBHOOK_URL**
- Name: `SLACK_WEBHOOK_URL`
- Value: `https://hooks.slack.com/services/YOUR/WEBHOOK/URL`
- Click "Add secret"

### Step 3: Required Secrets for CI/CD

Minimum required for basic CI/CD:
```bash
# Generate deploy key
ssh-keygen -t rsa -b 4096 -f deploy_key -N ""

# Add public key to deployment server
cat deploy_key.pub

# Add private key as secret DEPLOY_KEY
cat deploy_key | base64
```

---

## ðŸ” Environment Variables

Create `.env.production` and `.env.staging` in your repository (not in git):

```bash
# .env.staging
NODE_ENV=staging
API_PORT=3000
MONGODB_URI=mongodb+srv://user:pass@staging.mongodb.net/taxi-vtc
REDIS_HOST=staging-redis.example.com
REDIS_PORT=6379
JWT_SECRET=your-staging-secret-key
LOG_LEVEL=debug
```

```bash
# .env.production
NODE_ENV=production
API_PORT=3000
MONGODB_URI=mongodb+srv://user:pass@production.mongodb.net/taxi-vtc
REDIS_HOST=production-redis.example.com
REDIS_PORT=6379
JWT_SECRET=your-production-secret-key
LOG_LEVEL=info
```

---

## ðŸš€ Workflow Triggers

### CI Workflow (ci.yml)
Triggers on:
- Push to: main, develop, staging
- Pull requests to: main, develop, staging
- Daily schedule: 2 AM UTC

### CD Workflow (cd.yml)
Triggers on:
- Push to: main, staging
- Manual workflow dispatch

### Docker Workflow (docker.yml)
Triggers on:
- Push to: main, staging, develop
- Tags: v*
- Pull requests

### Quality Workflow (quality.yml)
Triggers on:
- Push to: main, develop, staging
- Pull requests

### Release Workflow (release.yml)
Triggers on:
- Git tags: v*

---

## ðŸ“Š Workflow Matrix Strategy

The CI workflow uses Node.js matrix for testing on multiple versions:

```yaml
node-version: [18.x, 20.x]
```

This tests on both Node 18 and 20. Adjust as needed for your requirements.

---

## ðŸ”’ Security Best Practices

1. **Never commit secrets** - Use GitHub Secrets only
2. **Rotate secrets regularly** - Monthly or after incidents
3. **Use environment-specific secrets** - Different secrets for staging/prod
4. **Limit secret scope** - Only grant necessary permissions
5. **Audit secret access** - Review GitHub audit logs
6. **Use OIDC tokens** - For cloud provider authentication
7. **Enable branch protection** - Require status checks before merging

---

## ðŸ“‹ Checklist

- [ ] Created SLACK_WEBHOOK_URL secret
- [ ] Created SNYK_TOKEN secret
- [ ] Created SONAR_TOKEN secret
- [ ] Created DEPLOY_KEY secret
- [ ] Created DEPLOY_URL secret
- [ ] Configured MongoDB connection strings
- [ ] Configured Redis endpoints
- [ ] Set up Docker registry authentication
- [ ] Enabled branch protection rules
- [ ] Set up Slack notifications

---

## ðŸ§ª Testing Secrets

### Test Slack Notification
```bash
curl -X POST -H 'Content-type: application/json' \
  --data '{"text":"Test notification"}' \
  $SLACK_WEBHOOK_URL
```

### Verify GitHub Token Permissions
```bash
curl -H "Authorization: token $GITHUB_TOKEN" \
  https://api.github.com/user
```

---

## ðŸ”„ Renewing Secrets

### Update Deploy Key
```bash
# Generate new key
ssh-keygen -t rsa -b 4096 -f deploy_key_new -N ""

# Update GitHub secret
cat deploy_key_new | base64 > /tmp/key.b64

# Update deployment server
cat deploy_key_new.pub >> ~/.ssh/authorized_keys
```

### Update API Keys
1. Regenerate the key in the service provider
2. Update the corresponding GitHub secret
3. Verify deployment still works
4. Document the change

---

## ðŸ“ž Troubleshooting

### Workflow Fails: "Secret not found"
- Verify secret name matches exactly (case-sensitive)
- Ensure secret is in the correct repository
- Check if secret is accessible to the workflow

### Docker Push Fails
- Verify GITHUB_TOKEN has push permissions
- Check container registry credentials
- Ensure Docker buildx is properly installed

### Deployment Fails
- Verify DEPLOY_KEY is in correct format
- Check DEPLOY_URL is accessible
- Review deployment logs in Actions tab

### Test Failures
- Check MongoDB connection string
- Verify Redis is running
- Review test logs for specific errors

---

## ðŸ“š References

- [GitHub Secrets Documentation](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [GitHub Actions Best Practices](https://docs.github.com/en/actions/learn-github-actions/contexts)
- [Docker Build Action](https://github.com/docker/build-push-action)
- [Snyk GitHub Action](https://github.com/snyk/actions)

---

**Last Updated**: December 2024  
**Version**: 1.0  
**Status**: Ready for Configuration
